# ---------------------------------------------------------------
# Workflow File : PR-notify.yml
# File Authors  : Aoran Zeng   <ccmywish@qq.com>
# Contributors  :  Nul None    <nul@none.org>
#               | Mikachu2333  <mikachu.23333@zohomail.com>
#               |
# Created On    : <2025-06-19>
# Last Modified : <2025-06-26>
#
# Notify PR
# ---------------------------------------------------------------

name: Comment PR

on:
  pull_request_target:
    types: [
        opened,
        ready_for_review, # draft PR 转为正式 PR
        review_requested,
        reopened,
      ]

jobs:
  enforce-dev-branch:
    name: 强制使用dev分支
    runs-on: ubuntu-latest
    # 非self-pr、非main、非gh-build、非gh-site
    if: (github.event.pull_request.base.ref == 'main' || github.event.pull_request.base.ref == 'gh-build' || github.event.pull_request.base.ref == 'gh-site') && github.event.pull_request.head.repo.full_name != github.event.pull_request.base.repo.full_name
    steps:
      - name: 警告分支错误
        uses: thollander/actions-comment-pull-request@v3
        with:
          message: |
            ❤️ 感谢你的贡献！你的 PR 当前基于 ${{GITHUB_BASE_REF}} 分支，请修改为非 `main` 分支（**推荐使用 `dev` 分支**）！
          comment-tag: "❤️ 感谢你的贡献！"
      - run: |
          echo "::error::❌ PR 必须以非 `main` 分支为目标！当前是 ${GITHUB_BASE_REF} 分支"
          exit 1

  welcome:
    name: 欢迎PR者
    runs-on: ubuntu-latest
    # 非self-pr、非main、非gh-build、非gh-site
    if: (github.event.pull_request.base.ref != 'main' && github.event.pull_request.base.ref != 'gh-build' && github.event.pull_request.base.ref != 'gh-site') && github.event.pull_request.head.repo.full_name != github.event.pull_request.base.repo.full_name
    steps:
      - name: 感谢pr并回复
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ❤️ 感谢你的贡献！我们将在5天内阅读此 PR 并回复你
          edit-mode: replace
          reactions: heart
